<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="icon" href="asset/icon/favicon.ico">
  <link rel="icon" sizes="16x16" href="asset/icon/favicon-16x16.png">
  <link rel="icon" sizes="32x32" href="asset/icon/favicon-32x32.png">
  <link rel="icon" sizes="180x180" href="asset/icon/favicon-180x180.png">
  <link rel="icon" sizes="192x192" href="asset/icon/favicon-192x192.png">
  <link rel="icon" sizes="512x512" href="asset/icon/favicon-192x192.png">
  <link rel="stylesheet/less" type="text/css" href="styles.less" />
  <title>Uonihon</title>
  <script src="https://cdn.jsdelivr.net/npm/less"></script>
</head>

<body onload="initUonihon()">

  <script>

    const HOST = "http://192.168.1.86:8080"

    function initUonihon() {
      console.log("OKDOKO")
      nextWord()
    }

    function nextWord() {
      fetch(HOST + "/word", {
        method: "GET",
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        }
      })
        .then((response) => response.json())
        .then((json) => {
          console.log(json);
          resetObfuscation();
          obfuscation('word');
          obfuscation('reading');
          obfuscation('explainer');
          document.getElementById('word').innerText = json.word??"";
          document.getElementById('reading').innerText = json.reading??"";
          document.getElementById('meaning').innerText = json.meaning??"";
          document.getElementById('alternative').innerText = json.alternative??"";
          document.getElementById('explainer').innerText = (json.explainer?.replace(/\\n/g, "\n"))??"";

          var sentences = document.getElementById('sentences-container');
          sentences.replaceChildren();
          (json.sentences??[])?.forEach(function (sentence, i) {
            let htmlSentence = `
              <div class="line"> </div>
              <div class="card one" onclick="obfuscation('sentence${i+1}')">
                <div class="label">Phrase ${i+1}</div>
                <div id="sentence${i+1}" class="card-inner obfuscated long">${sentence.japanese}</div>
              </div>
              <div class="card one" onclick="obfuscation('translation${i+1}')">
                <div class="label">Traduction ${i+1}</div>
                <div id="translation${i+1}" class="card-inner long">${sentence.translation}</div>
              </div>
            `
            sentences.insertAdjacentHTML('beforeend', htmlSentence)
          });
        });
    }

    function doSomething(toWrite) {
      fetch(HOST + "kanjis", {
        method: "POST",
        body: JSON.stringify({
          message: toWrite
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8"
        }
      })
        .then((response) => response.json())
        .then((json) => console.log(json));
    }

    function setVisibleMainTab(tab) {
      var kanaTabNode = document.querySelector('.kanaTab');
      var kanjiTabNode = document.querySelector('.kanjiTab');
      var vocabularyTabNode = document.querySelector('.vocabularyTab');
      var toSetVisibleNode = document.querySelector('.' + tab);
      kanaTabNode.style.visibility = 'collapse';
      kanjiTabNode.style.visibility = 'collapse';
      vocabularyTabNode.style.visibility = 'collapse';
      toSetVisibleNode.style.visibility = 'visible';
      color = ""
      switch (tab) {
        case 'kanjiTab':
          color="lighten(@secondary,10%)"
          break;
        case 'kanaTab':
          color="lighten(@tertiary,10%)"
          break;
        default:
          color="lighten(@primary,10%)"
      }
      less.modifyVars({
        '@current-tab-color': color,
      });
    }

    function setVisibleSubTab(tab) {
      var produceTabNode = document.querySelector('.produceTab');
      var consumeTabNode = document.querySelector('.consumeTab');
      var toSetVisibleNode = document.querySelector('.' + tab);
      produceTabNode.style.visibility = 'collapse';
      consumeTabNode.style.visibility = 'collapse';
      toSetVisibleNode.style.visibility = 'visible';
    }

    function resetObfuscation() {
      let elements = document.getElementsByClassName("card-inner")
      Array.from(elements).forEach(e => {
        if (e.classList.contains("obfuscated")) {
            e.classList.remove("obfuscated");
        }
      })
    }

    function obfuscation(id) {
      let element = document.getElementById(id)
      if (element.classList.contains("obfuscated")) {
        element.classList.remove("obfuscated");
      } else {
        element.classList.add("obfuscated");
      }
    }

  </script>

  <div class="app-container">
    <div class="main-view-containers">
      <div class="main-view-container vocabularyTab">
        
        <div class="card-container">

          <div class="card two" onclick="obfuscation('word')">
            <div class="label">Mot</div>
            <div id='word' class="card-inner short" >
            </div>
          </div>
          
          <div class="card two" onclick="obfuscation('reading')">
            <div class="label">Prononciation</div>
            <div id="reading" class="card-inner short"></div>
          </div>

        </div>

        <div class="line"> </div>

        <div class="card-container">
          
          <div class="card two" onclick="obfuscation('meaning')">
            <div class="label">Sens Principal</div>
            <div id="meaning" class="card-inner long"></div>
          </div>

          <div class="card two" onclick="obfuscation('alternative')">
            <div class="label">Autres Sens</div>
            <div id="alternative" class="card-inner long">
            </div>
          </div>

        </div>

        <div class="line"> </div>

        <div class="card one" onclick="obfuscation('explainer')">
          <div class="label">Explication</div>
          <div id="explainer" class="card-inner long"></div>
        </div>

        <div id="sentences-container">
        </div>

      </div>


      <div class="main-view-container kanjiTab" style="visibility: collapse;">
        this is the kanji tab Start
        <div class="wideguy secondary-background"></div>
        this is the kanji tab End
      </div>
      <div class="main-view-container kanaTab" style="visibility: collapse;">
        this is the kana tab Start
        <div class="wideguy tertiary-background"></div>
        this is the kana tab End
      </div>
    </div>
  
    <!-- SUB FOOTER TABS -->
    <div class="tabs-container sub-sub-tabs-container">
      <div class="tab three-tabs" onclick="setVisibleTab('produceTab')">
        <img class="tab-icon" src="asset/list.png" alt="Vocabulary icon">
        <span class="tab-text">List</span>
      </div>
      <div class="tab three-tabs" onclick="nextWord()">
        <img class="tab-icon" src="asset/next.png" alt="Vocabulary icon">
        <span class="tab-text">Next</span>
      </div>
      <div class="tab three-tabs" onclick="setVisibleTab('consumeTab')">
        <img class="tab-icon" src="asset/search.png" alt="Kanji icon">
        <span class="tab-text">Search</span>
      </div>
    </div>
  
    <!-- SUB FOOTER TABS -->
    <div class="tabs-container sub-tabs-container">
      <div class="tab three-tabs" onclick="setVisibleTab('produceTab')">
        <img class="tab-icon" src="asset/arrow-down.png" alt="Vocabulary icon">
        <span class="tab-text">Read and Listen</span>
      </div>
      <div class="tab three-tabs" onclick="setVisibleTab('produceTab')">
        <img class="tab-icon" src="asset/cross.png" alt="Vocabulary icon">
        <span class="tab-text">Add</span>
      </div>
      <div class="tab three-tabs" onclick="setVisibleTab('consumeTab')">
        <img class="tab-icon" src="asset/arrow-up.png" alt="Kanji icon">
        <span class="tab-text">Write and Speak</span>
      </div>
    </div>

    <!-- MAIN FOOTER TABS -->
    <div class="tabs-container main-tabs-container">
      <div class="tab three-tabs vocabularyTab" onclick="setVisibleMainTab('vocabularyTab')">
        <img class="tab-icon" src="asset/letterW.png" alt="Vocabulary icon">
        <span class="tab-text">Vocabulary</span>
      </div>
      <div class="tab three-tabs kanjiTab" onclick="setVisibleMainTab('kanjiTab')">
        <img class="tab-icon" src="asset/complicatedKanji.png" alt="Kanji icon">
        <span class="tab-text">Kanji</span>
      </div>
      <div class="tab three-tabs kanaTab" onclick="setVisibleMainTab('kanaTab')">
        <img class="tab-icon" src="asset/HiraganaKa.png" alt="Kana icon">
        <span class="tab-text">Kana</span>
      </div>
    </div>

  </div>

</body>

</html>